# 讲给前端的Linux必备知识② :star:

::: warning
**课件**
前端必会的Linux基础
:::

> 15min开讲

## 1. Linux架构体系

> 15min~1h4min讲完架构体系

::: tip
**Linux 的体系架构图解析**
* 通常说的Linux是**内核**，内核不可直接被操作，只提供函数和api，所以只有内核不行，还必须有壳，即shell
* **shell**：装好虚拟机之后，命令界面即shell，是人机交互的文本界面；服务器很少用图形界面，Linux有桌面版，如欧版图
* Linux上跑的服务是**应用程序**，应用程序直接通过系统调用[操作系统的API]和内核通信，nodeJS属于应用程序这层，nodeJS也有自己的库供自己调用，但不属于公用函数库
* **公用函数库**是C语音写的，nodeJS是C++写的
* Linux架构简捷不简单
:::

::: tip
**用户模式、内核模式**
* **用户模式**：自己的程序或服务运行在此模式，应用程序在用户模式中，底层是复杂函式库，是以第三方形式提供，最重要的库是glib，它给应用程序提供功能，KDE是图形界面；一些函数库都是操作系统的发行版，自带的
* **内核模式**：即内核在干活，像系统中断，内存管理等都是内核模式
* Linux运行时，是在用户模式和内核模式之间来回切换的
* 单核CPU，同一时间只能执行一个程序，但为什么用户觉得是多个同时进行，因为CPU每隔几毫秒会切换一个程序执行👆
* 操作系统是OS
:::

::: tip
**Linux核心子系统**
* **Process management [进程管理]**：ps命令是看当前系统跑了哪些进程，不是实时状态；top命令可看进程实时状态，q正常退出，ctrl+c强行退出
* **Memory management [内存管理]**：当系统运行起来时，需要向操作系统要内存，操作系统给它分配，当程序结束时，内存要回收
* **File systems [文件系统]**：Linux中把所有东西看成文件，如键盘、鼠标、显示器；键盘鼠标是外围设备，要想操作外围设备，得有一种手段，这种手段通过硬件端口，再通过总线，跟其他设备连接
    * 设备给你提供数据叫读，你给设备提供数据叫写，即**IO**操作
    * **IO**就是输入与输出，输入与输出是相对于**CPU**说的；
* **Device drivers [设备驱动]**：推动外围设备能正常工作；驱动的意义：把硬件的操作规则按照操作系统统一的文件接口给实现出来；声卡显卡做任务分配等；Linux为了保证兼容性好，设备驱动可能会特别大
* **Network [网络]**：Linux天生为网络而生，网络提供底层功能
:::

::: tip
**windows架构体系**
* 基于微内核
* 最重要的是硬件抽象层
* 为了兼容性好，用户模式的应用程序划分了子系统，虚拟执行环节
* POSIX是一个工业标准
:::

::: tip
**windows架构与Linux架构的区别**
* 是一种基于微内核的实现，Linux是基于宏内核的实现
    * 宏内核是把所有功能打在一个包里，扩展新的功能需要重新编译，比较麻烦；但容易裁剪
    * 微内核把不同的功能分成小模块，小模块互相调用，非常灵活；但来回调用会损失性能
    * 宏内核相比微内核性能要好一点
* 都可以看所有程序进程
:::

* 现在的操作系统架构都是分为用户模式和内核模式，好处是安全，防止程序崩溃和恶意系统入侵
* 操作系统升级时需重新编译内核，需要替换原来的内核
* Linux会有一些奇怪的文件，如libncurses.so.5.9，类似于windows中dll文件，如果系统报这类文件出错，不要删，要重装；装的时候使用yum命令，如yum zlib[库名]-dev；make install有时会报错，缺少某某开发库，也要重装，欧版图的话 apt-get install xxx-dev，centos的话 yum install xxx-devel
* Linux/Uninx等操作系统都提供了一套标准的调用接口和操作流程，即POSIX

## 2. linux常⽤用命令

<p style="color:red">《前端必会的Linux基础》文档上列出的命令必须自己敲一遍</p>

**上传下载**
* 在服务器上传文件：scp 本地路径 用户名@ip:/服务器路径
* 在服务器上传文件夹：scp -r 本地路径 用户名@ip:/服务器路径
* 从服务器下载文件：scp 服务器路径 用户名@ip:/本地路径

## 3. shell

shell先只看命令，不写脚本

## 4. vi编辑器

> 2h-2h12min讲vi编辑

在Linux下是一个非常强大的文本编辑器，但非常难用，它是命令行编辑器

* 直接vi，创建一个空文件；vi 文件名，打开文件编辑
* 先esc，退出编辑；再冒号进入命令状态，:q退出，:w保存，:wq保存退出，:!q不保存退出

vi命令表打印出来，放旁边看着学！

## 5. 用户和用户组

> 1h9min-1h28min讲用户权限、链接类型的文件

* 用户相关命令比较少用，生产环境下不要用超级管理员用户root
* 安装虚拟机后，创建一个普通用户，提权
    * sudu
    * 切换用户：su 用户名

::: tip
**权限**
* 使用长模式罗列目录，如ls -l，前面有一坨字符，如drwxr-xr-x.，第一个字符是文件类型，d是目录dir，l是连接link文件，-是普通文件；除了第一个字符，后面这些就是权限
* 权限字符分三组，ch mod[change model]命令就是操作权限
    * 第一组：rwx[read write  execute]即读写执行，给文件所有者所用，如root，root可以给其他用户改权限
    * 第二组：文件所有者所在的用户组
    * 第三组：其他用户
* 777，755是什么？
    * rwx对应111，转化十进制是7
    * r-x对应101，转化十进制是5
    * rw-对应110，转化十进制是6
    * 所以设置777、755就是设置对应权限
:::

::: tip
**连接文件link**
* 连接分软连接、硬连接，windows的快捷方式是软连接
    * 软连接：连接文件指向路径
    * 硬连接：与磁盘文件系统有关
        * 磁盘文件系统：是复杂的链式结构
        * 硬盘不能直接用，必须格式化，格式化就是分扇区，磁盘有磁道，信息保存在磁道上
        * 文件有结构，包含编号、位置记录[在硬盘上的哪个位置]
    * 软连接与硬连接的区别：只要文件还存在，文件名修改了，硬连接不失效，软连接失效
        * 日志文件log1，改名log2再生成新的空文件log1，日志还是往log2里打；所以要复制log1内容到log2，再清空log1
:::

::: warning
**课件**
Linux开发环境出准备讲义
:::

## 6. 系统启动

> 2h13min~2h25min讲系统启动

* 计算机开机后听见嘀一声，就是硬件自检完毕，CPU、内存、硬盘等信息
* 操作系统的引导程序，在磁盘外围第一磁道，计算机硬件有一个芯片BIOS[基本输入输出系统]，会找到硬盘上的引导程序地址[物理地址]，这个程序不超过512字节，这个程序通过文件系统找操作系统内核，把操作系统内核放到内存中某位置，再跳到操作系统在内存中的起始位置，此时操作权才交到操作系统手中，操作系统才启动起来
    * 操作系统启动做的事：启动1号进程，1号进程负责把后面的进程和服务拉起来，windows的这个进程是0号进程
* 查看进程时，nginx有5个进程，最上面的是master主进程，后面4个worker工作进程，主进程负责创建并管理工作进程，他们是父子关系，意味着主进程结束，子进程也会结束，所以要kill主进程

关闭虚拟机：shutdown -h now

## 4.1 网络端口、端口冲突

> 1h30min-1h42min讲服务端口冲突，如何排查

::: tip
**排查服务端口冲突**
* Linux会跑很多服务，有的时候会产生冲突，冲突主要在端口上
    * 端口：来自于传输层，每一个进程都有一个端口，端口不能跨进程使用
    * **如何排查**：netstat命令，netstat -an命令回车后，前面会多一些东西，即所有端口；netstat -anp查看端口对应进程，最后一栏显示进程编号pid和名称；还可以使用ss -p
        * Local Address本地地址：Linux自己的IP
        * Foreign Address远端地址：当有其他计算机连到你的端口
        * State状态：套接字的状态，侦听、传输等
        * ::相当于0.0.0.0，::1相当于127.0.0.1
    * linux进程命名时，只要后边有d，即守护进程，即服务
    * **如何解决**：找到pid后，kill 对应pid，强行终止进程
        * ps aux命令也能看到系统所跑进程，pid是唯一的
        * kill：不是杀的意思，是发送信号
        * 进程状态：s是sleep睡眠，r是run运行，z是僵尸进程
            * 僵尸进程：一般进程停止应该被回收，但这种进程没有被回收，代码写的不严谨或者执行过程出问题会出现
:::

* mac没有netstat命令：yum install net-tools

## 4.2 服务管理

* 管理服务：systemctl start | stop | status 服务名

## 其他

> 2h25min之后答疑

**centos没有滚动条，不能上下翻页？？**
* 装虚拟机后，不要在窗口操作，而要用终端，因为窗口不能复制粘贴、不能向上翻页

vm tools

**如何问问题**
* 1、什么问题，什么现象，什么环境
* 2、你猜测是怎样的，你曾经怎么解决的
* 3、上下文截图，是做了什么才出现的问题
* 4、遇到问题先自己想想怎么解决，再问
* 5、思路很重要，一定要先自己琢磨，不是百度谷歌